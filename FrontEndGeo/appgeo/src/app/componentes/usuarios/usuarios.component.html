<!-- Abrir Modal -->
<ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">USUARIO</h4>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <div class="content-viewport">
        <div class="row">
          <div class="col-lg-12">
            <div class="item-wrapper py-2">
              <form [formGroup]="form" (ngSubmit)="Guardar()">
                <!-- Campos de Persona -->
                <div class="form-group">
                  <label for="nombres">Nombres</label>
                  <input type="text" class="form-control" id="nombres" placeholder="Ingresa los nombres" formControlName="nombres" required />
                </div>
                <div class="form-group">
                  <label for="apellidos">Apellidos</label>
                  <input type="text" class="form-control" id="apellidos" placeholder="Ingresa los apellidos" formControlName="apellidos" required />
                </div>
                <div class="form-group">
                  <label for="ci">CI</label>
                  <input type="text" class="form-control" id="ci" placeholder="Ingresa el CI" formControlName="ci" required />
                </div>
                <!-- Campo: Rol -->
                <div class="form-group">
                  <label for="idrol">Rol</label>
                  <select class="form-control" id="idrol" formControlName="idrol" >
                    <option selected *ngFor="let rol of roles" [value]="rol.idrol">{{rol.nombre}}</option>
                  </select>
                </div>
                <!-- Campo: Username -->
                <div class="form-group">
                  <label for="username">Username</label>
                  <input type="text" class="form-control" id="username" placeholder="Ingresa el username" formControlName="username" required />
                </div>
                <!-- Campo: Contraseña -->
                <div class="form-group">
                  <label for="password">Contraseña</label>
                  <input type="password" class="form-control" id="password" placeholder="Ingresa la contraseña" formControlName="password" required />
                </div>
                <!-- Botones del modal -->
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cerrar</button>
                  <button class="btn btn-success" [disabled]="form.invalid" type="submit" (click)="modal.close()">Guardar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
  <!-- Cerrar Modal -->
  
  <div class="content-viewport">
    <div class="row">
      <div class="col-lg-12">
        <div class="row py-4">
          <div class="col-sm-10">
            <div>
              <h2>USUARIO</h2>
            </div>
          </div>
          <div class="col-sm-2 text-right">
            <button type="button" class="btn btn-primary has-icon btn-rounded buttoncolor" (click)="Guardarinstruct(content)">
              <i class="mdi mdi-plus-circle"></i>AGREGAR
            </button>
          </div>
        </div>
  
        <!-- Buscador -->
        <div>
          <div class="row">
            <div class="col-md-5">
              <label><span class="subtitulos">BUSCAR</span></label>
            </div>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-md-5">
            <div class="input-group">
              <select class="form-control col-md-3 text-center" [(ngModel)]="criterio">
                <option selected value="username">Username</option>
                <option value="idrol">Rol</option>
                <option value="idpersona">Persona</option>
              </select>
              <input type="text" class="form-control" name="filter" placeholder="Buscar..." [(ngModel)]="search" />
            </div>
          </div>
  
          <div class="col-md-7 text-right">
            <button type="button" class="btn btn-success has-icon btn-rounded dropdown-toggle buttoncolor botonUp" (click)="LimpiarSearch()" clickable>
              <i class="mdi mdi-reload"></i>LIMPIAR
            </button>
          </div>
        </div>
      </div>
  
      <!-- Tabla de usuarios -->
      <div class="col-lg-12">
        <div class="item-wrapper">
          <div class="table-responsive">
            <table class="table info-table table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Username</th>
                  <th>Rol</th>
                  <th>Persona</th>
                  <th>Fecha de Registro</th>
                  <th>Estado</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let usuario of listaUsuarios | filterone:criterio:search | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize; let i = index">
                  <td>{{usuario.idusuario}}</td>
                  <td>{{ usuario.username }}</td>
                  <td>{{ obtenerNombreRol(usuario.idrol) }}</td>
                  <td>{{ usuario.IdPersonanav.nombres }} {{ usuario.IdPersonanav.apellidos }}</td>
                  <td>{{ usuario.fechareg | date:'dd/MM/yyyy' }}</td>
                  <td>{{usuario.estado}}</td>
                  <td *ngIf="usuario.estado == 'Activo'"> <label class="badge badge-success btnacti">ACTIVO</label></td>
                  <td *ngIf="usuario.estado == 'Inactivo'"> <label class="badge badge-danger">INACTIVO</label></td>
                  <td>
                    <button type="button" (click)="SeleccionarUsuario(content, usuario)" class="btn btn-dark has-icon btn-rounded" style="margin: 10px">
                      <i class="mdi mdi-lead-pencil"></i>Modificar
                    </button>
                    <button type="button" (click)="CambiarEstado(usuario, 'Inactivo')" class="btn btn-danger has-icon btn-rounded" *ngIf="usuario.estado == 'Activo'">
                      <i class="mdi mdi-delete"></i>Desactivar
                    </button>
                    <button type="button" (click)="CambiarEstado(usuario, 'Activo')" class="btn btn-success has-icon btn-rounded" *ngIf="usuario.estado == 'Inactivo'">
                      <i class="mdi mdi-arrow-right-bold-circle"></i>Activar
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="float-end">
            <ngb-pagination [pageSize]="pageSize" [collectionSize]="pagesizee" [(page)]="page" [boundaryLinks]="true"></ngb-pagination>
          </div>
        </div>
      </div>
    </div>
  </div>